<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Encrypted Static Site</title>
    </head>
    <body>
        <div id="content"></div>
        <script src="base64.js"></script>
        <script>
            async function decryptData(encryptedContent, secretKey) {
                const { iv, encryptedData } = encryptedContent;
                const decoder = new TextDecoder();

                const key = await crypto.subtle.importKey(
                    'raw',
                    secretKey,
                    { name: 'AES-GCM' },
                    false,
                    ['encrypt', 'decrypt'],
                );

                const decryptedData = await crypto.subtle.decrypt(
                    { name: 'AES-GCM', iv: new Uint8Array(iv) },
                    key,
                    new Uint8Array(encryptedData),
                );

                return decoder.decode(decryptedData);
            }

            function getContent() {
                const urlParams = new URLSearchParams(window.location.search);
                const secretKeyBase64 = urlParams.get('secretkey');
                if (!secretKeyBase64) {
                    document.getElementById('content').textContent =
                        'Access denied. Secret key is missing.';
                    return;
                }

                const secretKey = Uint8Array.from(atob(secretKeyBase64), (c) =>
                    c.charCodeAt(0),
                );
                const encryptedContent = {
                    iv: [
                        /* your IV values here */
                    ],
                    encryptedData: [
                        /* your encrypted data values here */
                    ],
                };

                decryptData(encryptedContent, secretKey)
                    .then((decryptedContent) => {
                        document.getElementById('content').innerHTML =
                            decryptedContent;
                    })
                    .catch((error) => {
                        console.error(error);
                        document.getElementById('content').textContent =
                            'Access denied. Invalid secret key.';
                    });
            }

            getContent();
        </script>
    </body>
</html>
